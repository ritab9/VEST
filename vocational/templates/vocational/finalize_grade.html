{%  extends 'base.html' %}
{% load i18n %}
  {% load static %}
  {% load crispy_forms_tags %}

  {% block title %} Add Grade {% endblock title %}

{% block content %}
    <div class = "row mt-3">
    <div class="col-sm-auto">
        <table class="table-sm mb-3">
            <td>
            <tbody>
                <tr><th scope="row">Quarter</th><td>{{ grade.quarter }}</td></tr>
                <tr><th scope="row">Department</th><td>{{ grade.department }}</td></tr>
                <tr><th scope="row">Type</th><td>{{ grade.get_type_display }}</td></tr>
                <tr><th>Date Evaluated</th><td>{{ grade.evaluation_date }}</td></tr>
                <tr><th scope="row">Instructor</th><td>{{ grade.instructor.last_name }}, {{ grade.instructor.first_name }}</td></tr>
            </tbody>
            </td>
            <td>
                <tr><th scope="row">Student</th><td>{{ grade.student.user.last_name }}, {{ grade.student.user.first_name }}</td></tr>
                <tr><th scope="row">Level</th><td>{{ grade.level }}</td></tr>
            </td>
        </table>

    </div>

    <div class="col-sm-auto mt-2">
        <form method = "POST">
            {% csrf_token %}

            <div class="row">
                <div class="col-sm-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>Ethic</th>
                                <th>Grade (1-5)</th>
                                {% if grade.type == "S" %}
                                    <th style="text-align: center"> Comment</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {{ ethic_formset.management_data }}
                            {{ ethic_formset.management_form }}
                            {% for form in ethic_formset %}
                                {{ form.non_field_errors }}
                                <tr>
                                    <td>{{ form.instance.ethic.name }}</td>
                                    <td>{{ form.score}}
                                        {{ form.score.errors}}</td>
                                    {% if grade.type == "S" %}
                                        <td>{{ form.comment}}{{ form.comment.errors}}</td>
                                    {% endif %}
                                </tr>
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if grade.type == "F" %}
                    <div class="col-sm-auto">
                        {{ formative_comments_form|crispy }}
                    </div>
                {% endif %}
                    <div class="col-sm-auto">
                        <div class="row">
                            {{ time_form|crispy }}{{ grade.quarter.school_year.schoolsettings.get_time_unit_display}}
                        </div>

                        <div class="mt-5" > {{ student_discussion_form|crispy }}</div>
                    </div>
                    <div class="col-sm-auto">
                    </div>
            </div>
            <div class="row align-content-center">
                <div class="col text-center">
                    <input class = "btn btn-sm btn-ISEIblue3 mt-3" name="save_c" type= "submit" value = "Save and Add Next Grade">
                    <input class = "btn btn-sm btn-ISEIblue3 mt-3" name="save_r" type= "submit" value = "Save and Return to Grade List">
                    <br>
                </div>
            </div>
        </form>
        <div class="row align-content-center">
            <div class="col text-center">
                <form method = "GET">
                    {% csrf_token %}
                    <input class ="btn btn-sm btn-danger mt-3" name="delete_add" type="submit" value="Delete and Add Next Grade">
                    <input class ="btn btn-sm btn-danger mt-3" name="delete_list" type="submit" value="Delete and Return to Grade List">
                </form>
            </div>
        </div>

    </div>

<script>
    /* Ajax to get level and ethic after student is selected
    $(document).ready(function () {
         //catch the form's submit event
        $("#id_student").change(function () {
            //create an AJAX call
              $.ajax({
                  data: $(this).serialize(), //get the form data
                  url: "{ % url "get_level" %}",
                  //on success
                  success: function(response){
                     document.getElementById('id_level').value = response.level_id;
                  },
                  //on error
                  error: function(response) {
                      alert(response.errors);
                  },
              });
              return false;
        });
    }); */

</script>


{% endblock %}
