{% load static %}
{% load group_tags %}


<nav class ="navbar navbar-expand-md navbar-dark bg-ISEIblue3">
    <img src="{% static 'appfiles/VestLogoBLK.png' %}" width="120" height="60" alt="VEST Logo">
     <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="nav navbar-nav">
                    {% if user.is_authenticated %}
<!-- ISEI Admin Links -->
                        {% if request.user|in_group:"isei_admin"%}
                            <li class="nav-item isei_admin">
                                <a class="nav-link" href="{% url 'isei_admin_dashboard' %}">Home </a>
                            </li>
                            <li class="nav-item isei_admin">
                                <a class="nav-link" href="{% url 'isei_data_summary'%}">Data Summary </a>
                            </li>

                            <li class="nav-item dropdown isei_admin">
                              <a class="nav-link dropdown-toggle p-3" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Data Management
                              </a>
                              <ul class="dropdown-menu bg-ISEIblue3" aria-labelledby="navbarDropdown">
                                  <li>
                                    <a class="nav-link" href="{% url 'add_school' %}"> Add School</a>
                                </li>
                                <li>
                                    <a class="nav-link" href="{% url 'add_school_admin' %}"> Add School Admin </a>
                                </li>

                              </ul>
                            </li>
                        {% endif %}

<!-- School Admin Links -->

                        {% if request.user|in_group:"school_admin" %}
                            <li class="nav-item school_admin">
                                <a class="nav-link" href="{% url 'school_admin_dashboard' request.user.profile.school.id %}">Dashboard </a>
                            </li>
                            <li class="nav-item dropdown school_admin ">
                              <a class="nav-link dropdown-toggle p-3" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                User Management
                              </a>
                              <ul class="dropdown-menu bg-ISEIblue3 mr-0 school_admin" aria-labelledby="navbarDropdown">
                                  <li>
                                    <a class="nav-link float-right" href="{% url 'manage_school_staff' request.user.profile.school.id %}"> School Staff</a>
                                </li>
                                <li>
                                    <a class="nav-link float-right" href="{% url 'manage_students' request.user.profile.school.id %}"> Students and Parents </a>
                                </li>

                              </ul>
                            </li>
                        {% endif %}

                        {% if request.user|in_group:"vocational_coordinator" %}
                            <li class="nav-item vocational_coordinator">
                                <a class="nav-link" href="">Vocational Coordinator Links</a>
                            </li>
                        {% endif %}

                        {% if request.user|in_group:"instructor" %}
                            <li class="nav-item instructor">
                                <a class="nav-link" href="">Instructor Links</a>
                            </li>
                        {% endif %}

                        {% if request.user|in_group:"parent" %}
                            <li class="nav-item parent">
                                <a class="nav-link" href="">Parent Links</a>
                            </li>
                        {% endif %}

                        {% if request.user|in_group:"student" %}
                            <li class="nav-item student">
                                <a class="nav-link" href="">Student Links</a>
                            </li>
                        {% endif %}

                    {% endif %}
                </ul>
            </div>



{% if user.is_authenticated and user.is_active%}
    <span>
    <div class="col">
        <span class ="name-msg"> {{request.user.first_name}} {{request.user.last_name}} </span>
        {% if request.user|in_more_groups %}
            <select class="bg-ISEIblue3 text-light" id="id_group" name="group">
                {% for g in request.user.groups.all %}
                    <option class="text-light" value="{{g.name}}">{{g.name}}</option>
                {% endfor %}
                <div style="display: none" id="group_info" data-value="more"></div>
            </select>
        {% else %}
            <div class="text-light">{{ request.user.groups.all.first }}</div>
            <div style="display: none" id="group_info2" data-value="one">One</div>
        {% endif %}
    </div>
    </span>
        <a href="{% url 'logout' %}" style =" color:#FFFFFF">Logout</a>
{% endif %}

     </div>
</nav>

<script type="text/javascript">

    var g_i = "{{request.user|in_more_groups}}";

    window.addEventListener("load", function() {
        if (g_i) {
            var selItem = sessionStorage.getItem("SelItem")
            $('#id_group').val(selItem);
            if (!$('#id_group').val()) {
                document.getElementById('id_group').selectedIndex = "0";
            };
            navbar_refresh(selItem);
        }
    });

    $('#id_group').change(function() {
            var selVal = $(this).val();
            sessionStorage.setItem("SelItem", selVal);
            var url = "{% url 'crash' %}";
            window.location.href = url;
            navbar_refresh(selVal);
    });

    function navbar_refresh(group){
        for (let element of document.querySelectorAll(".school_admin, .instructor, .vocational_coordinator, .parent")){
            element.style.display="none";
            };

        for (let element of document.getElementsByClassName(group)){
            element.style.display="";
        };
    };

</script>